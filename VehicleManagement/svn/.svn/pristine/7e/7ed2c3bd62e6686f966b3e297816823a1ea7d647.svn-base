import React, { Component } from 'react';
import {View,Text,StyleSheet,Image,FlatList,TextInput,Button, TouchableOpacity} from 'react-native';
import { ScrollView} from 'react-native-gesture-handler';
import { createAppContainer, createStackNavigator } from 'react-navigation';
import RentalHistory from './RentalHistory';
import {SEARCH_IMAGE} from './imageExport'
import {LinkVehicleFees,LinkSearchVehicleFees} from '../constLink/linkService'
class VehicleFees extends Component{
    constructor(props) {
        super(props);
        this.state = { 
            isloading:true,
            search:'',
        };
    }

    getDataVehicleFees(){
        return fetch(LinkVehicleFees)
        .then((response) => response.json())
        .then((responseJson) => {
            console.log(responseJson)
        this.setState({
            isLoading: false,
            dataSource: responseJson,
        }, function(){

        });

        })
        .catch((error) =>{
        console.error(error);
        });
    }

    componentDidMount(){
        this.getDataVehicleFees();
    }   
    
    seacrchVehicleFees(){
        fetch(LinkSearchVehicleFees, {
            method: "POST",
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                "firstname": this.state.search,
                "lastname" : this.state.search,
                "fullname" : this.state.search
            }),
        }).then((response) => response.json())
        .then((responseJson) => {
            console.log(responseJson)
            this.setState({
                isLoading: false,
                dataSource: responseJson,
            });
        })
        .catch((error) => {
        console.error(error);
        });
    }

    updateSearch = search => {
        this.setState({ search },this.seacrchVehicleFees.bind(this));
    };
    render(){
        const { search } = this.state;
        return(
            <ScrollView style={styles.mainContainer}>
                <View style={styles.contentSearch}>
                    <View style={styles.contentChildSearch}>
                        <Image style={styles.iconInputSearch} source={SEARCH_IMAGE}/>
                        <TextInput
                            style={styles.searchStyle}
                            placeholder="Nhập Tên Khách Hàng Muốn Tìm Kiếm..."
                            onChangeText={this.updateSearch}
                            value={search}
                        />
                    </View>
                </View>

                <View style={styles.bodyContent}>
                    <FlatList
                        style={styles.flatStyle}
                        data={this.state.dataSource}
                        renderItem={({item}) =>
                            <TouchableOpacity style={styles.touchableStyle}
                            onPress={() => this.props.navigation.navigate('RentalHistory',{ 
                                params: { 
                                    item,
                                    reFetchVehicleFees: (() => {
                                        this.getDataVehicleFees()
                                    }).bind(this)
                                } 
                            })}>
                                <View style={styles.bodyListView}>
                                    <View style={styles.listViewChild}>
                                        <View style={styles.listViewChildLeft}>
                                            <Image style={styles.imageStyle}
                                                source={{uri: 'https://static.independent.co.uk/s3fs-public/thumbnails/image/2017/09/12/11/naturo-monkey-selfie.jpg?w968h681'}}
                                            />
                                        </View>
                                        <View style={styles.listViewChildRight}>
                                            <Text style={styles.generalStyle}>Tên KH : {item.fullname}</Text>
                                            <Text style={styles.generalStyle}>SDT : {item.phone}</Text>
                                            <Text style={styles.generalStyle}>Ngày Thu Tiền : {item.payday}</Text>
                                        </View>
                                        </View>
                                </View>
                            </TouchableOpacity>
                        }
                        keyExtractor={({vehiclecode}, index) => vehiclecode.toString()
                    }
                    />
                </View>
            </ScrollView>
        );
    }
}

const RootContent = createStackNavigator(
{
    VehicleFees: {
        screen: VehicleFees,
        navigationOptions:{
            title: 'List Of VehicleFees',
            headerStyle: {
                width:'100%',
                textAlign: 'center',
                color: 'white',
                backgroundColor:'green',
                textAlignVertical: "center",
                fontSize:11,
                height:50,
            },
            headerTintColor: 'white',
        },
    },
    RentalHistory: {
        screen: RentalHistory,
        navigationOptions: {
            title: 'Manage Car Rental History',
            headerStyle: {
                width:'100%',
                textAlign: 'center',
                color: 'white',
                backgroundColor:'green',
                textAlignVertical: "center",
                fontSize:11,
                height:50,
            },
            headerTintColor: 'white',
        },
    },
},
{
    initialRouteName: 'VehicleFees',
}
);
  
const AppContainer = createAppContainer(RootContent);
  
export default class App extends React.Component {
    render() {
        return <AppContainer />;
    }
}

const styles = StyleSheet.create({
    mainContainer: {
        marginTop: 20,
        flex: 1,
    },
    headerContent:
    {
        alignItems:'center'
    },
    bodyContent:
    {
        width:'100%',
        justifyContent:'center',
        flexDirection:'column',
        alignItems:'center',
    },
    flatStyle:{
        width:'100%',
    },
    bodyListView:{
        width:'85%',
        alignItems: 'center',
        justifyContent:'center',
    },
    touchableStyle:{
        width: '100%',
        justifyContent: 'center',
        alignItems: 'center',
    },
    listViewChild:{
        alignItems: 'center',
        justifyContent:'center',
        flexDirection:'row',
        marginBottom:2,
    },
    generalStyle:{
        color: 'white',
        marginBottom: 10,
        textAlignVertical: "center",
        fontSize:16,
    },
    listViewChildLeft:{
        width:'40%',
    },
    listViewChildRight:{
        height:100,
        width:'60%',
        backgroundColor:'green',
    },
    contentSearch:{
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
        height:50
    },
    contentChildSearch:{
        flexDirection: 'row',
        justifyContent: 'center',
        alignItems: 'center',
        width: '85%',
        borderWidth:1,
        marginBottom:8,
        borderRadius:1,
        borderColor:'black',
    },
    iconInputSearch:{
        padding: 10,
        margin: 5,
        height: 25,
        width: 25,
        resizeMode : 'stretch',
        alignItems: 'center'
    },
    searchStyle:{
        flex:1,
    },
    imageStyle: {
        height:100,
        width:'100%',
    },
})